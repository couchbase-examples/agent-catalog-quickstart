 kaustavghosh@WQ7X9RQ6YW  ~/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph   main ±  poetry run python evals/eval_arize.py
2025-08-29 11:27:18,332 - phoenix.config - INFO - 📋 Ensuring phoenix working directory: /Users/kaustavghosh/.phoenix
2025-08-29 11:27:18,354 - phoenix.inferences.inferences - INFO - Dataset: phoenix_inferences_f991a860-32e4-4339-9c49-9490aea4d261 initialized
2025-08-29 11:27:21,546 - __main__ - INFO - ✅ Arize datasets client initialized successfully
2025-08-29 11:27:21,602 - __main__ - INFO - ✅ Phoenix evaluators initialized successfully
2025-08-29 11:27:21,602 - __main__ - INFO -    🤖 Using evaluator model: gpt-4o
2025-08-29 11:27:21,602 - __main__ - INFO -    📊 Available evaluators: ['relevance', 'qa_correctness', 'hallucination', 'toxicity']
2025-08-29 11:27:21,602 - __main__ - INFO - 🔧 Setting up Phoenix observability...
2025-08-29 11:27:23,752 - alembic.runtime.migration - INFO - Context impl SQLiteImpl.
2025-08-29 11:27:23,753 - alembic.runtime.migration - INFO - Will assume transactional DDL.
2025-08-29 11:27:23,770 - alembic.runtime.migration - INFO - Running upgrade  -> cf03bd6bae1d, init
2025-08-29 11:27:23,807 - alembic.runtime.migration - INFO - Running upgrade cf03bd6bae1d -> 10460e46d750, datasets
2025-08-29 11:27:23,813 - alembic.runtime.migration - INFO - Running upgrade 10460e46d750 -> 3be8647b87d8, add token columns to spans table
2025-08-29 11:27:23,815 - alembic.runtime.migration - INFO - Running upgrade 3be8647b87d8 -> cd164e83824f, users and tokens
2025-08-29 11:27:23,819 - alembic.runtime.migration - INFO - Running upgrade cd164e83824f -> 4ded9e43755f, create project_session table
2025-08-29 11:27:23,827 - alembic.runtime.migration - INFO - Running upgrade 4ded9e43755f -> bc8fea3c2bc8, Add prompt tables
2025-08-29 11:27:23,831 - alembic.runtime.migration - INFO - Running upgrade bc8fea3c2bc8 -> 2f9d1a65945f, Annotation config migrations
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_cumulative_llm_token_count_total
  next(self.gen)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_latency
  next(self.gen)
2025-08-29 11:27:23,890 - alembic.runtime.migration - INFO - Running upgrade 2f9d1a65945f -> bb8139330879, create project trace retention policies table
2025-08-29 11:27:23,893 - alembic.runtime.migration - INFO - Running upgrade bb8139330879 -> 8a3764fe7f1a, change jsonb to json for prompts
2025-08-29 11:27:23,901 - alembic.runtime.migration - INFO - Running upgrade 8a3764fe7f1a -> 6a88424799fe, Add auth_method column to users table and migrate existing authentication data.
2025-08-29 11:27:24,002 - alembic.runtime.migration - INFO - Running upgrade 6a88424799fe -> a20694b15f82, Cost-related tables
🌍 To view the Phoenix app in your browser, visit http://localhost:6007/
📖 For more information on how to use Phoenix, check out https://arize.com/docs/phoenix
2025-08-29 11:27:24,226 - __main__ - INFO - 🌐 Phoenix UI: http://localhost:6007/
🔭 OpenTelemetry Tracing Details 🔭
|  Phoenix Project: flight-search-agent-evaluation
|  Span Processor: SimpleSpanProcessor
|  Collector Endpoint: http://localhost:6007/v1/traces
|  Transport: HTTP + protobuf
|  Transport Headers: {}
|  
|  Using a default SpanProcessor. `add_span_processor` will overwrite this default.
|  
|  ⚠️ WARNING: It is strongly advised to use a BatchSpanProcessor in production environments.
|  
|  `register` has set this TracerProvider as the global OpenTelemetry default.
|  To disable this behavior, call `register` with `set_global_tracer_provider=False`.

2025-08-29 11:27:24,264 - __main__ - INFO - ✅ Phoenix setup completed successfully
2025-08-29 11:27:24,282 - __main__ - INFO - ✅ LangChain instrumentation enabled
2025-08-29 11:27:24,293 - __main__ - INFO - ✅ OpenAI instrumentation enabled
2025-08-29 11:27:28,561 - shared.couchbase_client - INFO - ✅ Successfully connected to Couchbase
2025-08-29 11:27:29,795 - shared.couchbase_client - INFO - ✅ Connected to existing bucket 'travel-sample'
2025-08-29 11:27:29,795 - shared.couchbase_client - INFO - 🗑️ Clearing scope: travel-sample.agentc_bookings
2025-08-29 11:27:32,056 - shared.couchbase_client - INFO - 🗑️ Clearing data from travel-sample.agentc_bookings.user_bookings_20250829...
2025-08-29 11:27:35,433 - shared.couchbase_client - INFO - ✅ Cleared collection: travel-sample.agentc_bookings.user_bookings_20250829
2025-08-29 11:27:35,433 - shared.couchbase_client - INFO - ✅ Completed clearing scope: travel-sample.agentc_bookings
2025-08-29 11:27:35,433 - main - INFO - ✅ Cleared existing flight bookings for fresh test run: travel-sample.agentc_bookings
2025-08-29 11:27:35,531 - data.airline_reviews_data - INFO - Downloading Indian Airlines Customer Reviews dataset from Kaggle...
2025-08-29 11:27:39,371 - data.airline_reviews_data - INFO - Loading reviews from /Users/kaustavghosh/.cache/kagglehub/datasets/jagathratchakan/indian-airlines-customer-reviews/versions/1/Indian_Domestic_Airline.csv
2025-08-29 11:27:39,413 - data.airline_reviews_data - INFO - Loaded 2210 airline reviews from Kaggle dataset
2025-08-29 11:27:39,417 - data.airline_reviews_data - INFO - Processed 2210 airline reviews into text format
2025-08-29 11:27:40,350 - main - INFO - 📊 Airline reviews collection: 2210 existing, 2210 expected
2025-08-29 11:27:40,351 - main - INFO - ✅ Collection already has correct document count (2210), skipping clear
2025-08-29 11:27:40,357 - __main__ - INFO - 🔧 Setting up flight search agent...
2025-08-29 11:27:40,358 - shared.agent_setup - INFO - ✅ Environment variables configured
2025-08-29 11:27:59,852 - shared.couchbase_client - INFO - ✅ Successfully connected to Couchbase
2025-08-29 11:28:02,831 - shared.couchbase_client - INFO - ✅ Connected to existing bucket 'travel-sample'
2025-08-29 11:28:04,769 - shared.couchbase_client - INFO - ℹ️ Collection 'airline_reviews' exists, keeping existing data
2025-08-29 11:28:08,737 - shared.couchbase_client - INFO - ✅ Primary index created successfully
2025-08-29 11:28:08,737 - shared.couchbase_client - INFO - ✅ Collection setup complete: agentc_data.airline_reviews
2025-08-29 11:28:08,740 - main - INFO - Loaded vector search index definition from agentcatalog_index.json
2025-08-29 11:28:09,793 - shared.couchbase_client - INFO - ℹ️ Vector search index 'airline_reviews_index' already exists
2025-08-29 11:28:09,793 - shared.agent_setup - INFO - 🔧 Setting up AI services for langgraph framework...
2025-08-29 11:28:10,103 - shared.agent_setup - INFO - ✅ Using latest Capella AI embeddings (direct API key + OpenAI wrapper)
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1756447090.121576 13675136 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1756447090.161839 13675136 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
2025-08-29 11:28:11,348 - shared.agent_setup - INFO - ✅ Using latest Capella AI LLM (direct API key + OpenAI wrapper)
2025-08-29 11:28:11,348 - shared.agent_setup - INFO - ✅ AI services setup completed for langgraph
2025-08-29 11:28:11,348 - shared.couchbase_client - INFO - 🔄 Loading data into vector store...
2025-08-29 11:28:32,795 - data.airline_reviews_data - INFO - Found 2210 existing documents in collection, skipping data load
2025-08-29 11:28:32,796 - shared.couchbase_client - INFO - ✅ Data loaded into vector store successfully
/Users/kaustavghosh/Desktop/agent-catalog-quickstart/shared/couchbase_client.py:370: LangChainDeprecationWarning: The class `CouchbaseVectorStore` was deprecated in LangChain 0.3.0 and will be removed in 1.0.0. An updated version of the class exists in the :class:`~langchain-couchbase package and should be used instead. To use it run `pip install -U :class:`~langchain-couchbase` and import as `from :class:`~langchain_couchbase.vectorstores import CouchbaseSearchVectorStore``.
  vector_store = CouchbaseVectorStore(
2025-08-29 11:28:59,738 - shared.couchbase_client - INFO - ✅ LangChain vector store setup complete: travel-sample.agentc_data.airline_reviews
2025-08-29 11:28:59,738 - shared.agent_setup - INFO - 🔧 Setting up AI services for langgraph framework...
2025-08-29 11:28:59,757 - shared.agent_setup - INFO - ✅ Using latest Capella AI embeddings (direct API key + OpenAI wrapper)
2025-08-29 11:29:08,360 - shared.agent_setup - INFO - ✅ Using latest Capella AI LLM (direct API key + OpenAI wrapper)
2025-08-29 11:29:08,361 - shared.agent_setup - INFO - ✅ AI services setup completed for langgraph
2025-08-29 11:29:42,596 - main - INFO - Agent Catalog integration successful
2025-08-29 11:29:42,600 - __main__ - INFO - ✅ Flight search agent setup completed successfully
2025-08-29 11:29:42,600 - __main__ - INFO - 🚀 Starting evaluation with 5 queries
2025-08-29 11:29:42,600 - __main__ - INFO - 📋 Evaluation Configuration:
2025-08-29 11:29:42,600 - __main__ - INFO -    🤖 Agent: Flight Search Agent (LangGraph)
2025-08-29 11:29:42,600 - __main__ - INFO -    🔧 Phoenix Available: ✅
2025-08-29 11:29:42,600 - __main__ - INFO -    📊 Arize Datasets: ✅
2025-08-29 11:29:42,600 - __main__ - INFO -    🧠 Phoenix Evaluators: ['relevance', 'qa_correctness', 'hallucination', 'toxicity']
2025-08-29 11:29:42,600 - __main__ - INFO - 
📋 Query 1/5
2025-08-29 11:29:42,600 - __main__ - INFO - 🔍 Evaluating query: Find flights from JFK to LAX
2025-08-29 11:29:42,602 - main - INFO - Flight Query: Find flights from JFK to LAX
2025-08-29 11:29:42,701 - main - INFO - ✅ Found tool: lookup_flight_info
2025-08-29 11:29:42,709 - main - INFO - ✅ Found tool: save_flight_booking
2025-08-29 11:29:42,716 - main - INFO - ✅ Found tool: retrieve_flight_bookings
2025-08-29 11:29:42,723 - main - INFO - ✅ Found tool: search_airline_reviews


> Entering new AgentExecutor chain...
Thought: I need to find available flights between JFK and LAX airports. 
Action: lookup_flight_info
Action Input: "JFK,LAX"
Observation2025-08-29 11:29:44,133 - main - INFO - 🔧 Tool lookup_flight_info called with raw input: 'JFK,LAX"\nObservation'
2025-08-29 11:29:44,133 - main - INFO - 🧹 Tool lookup_flight_info cleaned input: 'JFK,LAX'
2025-08-29 11:29:45,205 - main - INFO - ✅ Tool lookup_flight_info executed successfully
Available flights from JFK to LAX:

1. AS flight from JFK to LAX using 321 762
2. B6 flight from JFK to LAX using 320
3. DL flight from JFK to LAX using 76W 752
4. QF flight from JFK to LAX using 744
5. AA flight from JFK to LAX using 32B 762
6. UA flight from JFK to LAX using 757
7. US flight from JFK to LAX using 32B 762
8. VX flight from JFK to LAX using 320Question: Find flights from JFK to LAX
Thought: I need to find available flights between JFK and LAX airports.
Action: lookup_flight_info
Action Input: "JFK,LAX"
Observation2025-08-29 11:29:45,990 - main - INFO - 🔧 Tool lookup_flight_info called with raw input: 'JFK,LAX"\nObservation'
2025-08-29 11:29:45,990 - main - INFO - 🧹 Tool lookup_flight_info cleaned input: 'JFK,LAX'
2025-08-29 11:29:46,228 - main - INFO - ✅ Tool lookup_flight_info executed successfully
Available flights from JFK to LAX:

1. AS flight from JFK to LAX using 321 762
2. B6 flight from JFK to LAX using 320
3. DL flight from JFK to LAX using 76W 752
4. QF flight from JFK to LAX using 744
5. AA flight from JFK to LAX using 32B 762
6. UA flight from JFK to LAX using 757
7. US flight from JFK to LAX using 32B 762
8. VX flight from JFK to LAX using 320

> Finished chain.
2025-08-29 11:29:46,259 - __main__ - INFO - ✅ Query completed in 3.66s
2025-08-29 11:29:46,259 - __main__ - INFO - 
📋 Query 2/5
2025-08-29 11:29:46,259 - __main__ - INFO - 🔍 Evaluating query: Book a flight from LAX to JFK for tomorrow, 2 passengers, business class
2025-08-29 11:29:46,261 - main - INFO - Flight Query: Book a flight from LAX to JFK for tomorrow, 2 passengers, business class
2025-08-29 11:29:46,362 - main - INFO - ✅ Found tool: lookup_flight_info
2025-08-29 11:29:46,369 - main - INFO - ✅ Found tool: save_flight_booking
2025-08-29 11:29:46,376 - main - INFO - ✅ Found tool: retrieve_flight_bookings
2025-08-29 11:29:46,382 - main - INFO - ✅ Found tool: search_airline_reviews


> Entering new AgentExecutor chain...
Thought: To book a flight, I need to find available flights between LAX and JFK for tomorrow. 
Action: lookup_flight_info
Action Input: "LAX,JFK"
Observation2025-08-29 11:29:47,106 - main - INFO - 🔧 Tool lookup_flight_info called with raw input: 'LAX,JFK"\nObservation'
2025-08-29 11:29:47,106 - main - INFO - 🧹 Tool lookup_flight_info cleaned input: 'LAX,JFK'
2025-08-29 11:29:47,336 - main - INFO - ✅ Tool lookup_flight_info executed successfully
Available flights from LAX to JFK:

1. AS flight from LAX to JFK using 321 762
2. B6 flight from LAX to JFK using 320
3. DL flight from LAX to JFK using 76W 752
4. QF flight from LAX to JFK using 744
5. UA flight from LAX to JFK using 757
6. AA flight from LAX to JFK using 32B 762
7. US flight from LAX to JFK using 32B 762
8. VX flight from LAX to JFK using 320Question: Book a flight from LAX to JFK for tomorrow, 2 passengers, business class Thought:Thought: To book a flight, I need to find available flights between LAX and JFK for tomorrow. 
Action: lookup_flight_info
Action Input: "LAX,JFK"
Observation2025-08-29 11:29:48,281 - main - INFO - 🔧 Tool lookup_flight_info called with raw input: 'LAX,JFK"\nObservation'
2025-08-29 11:29:48,281 - main - INFO - 🧹 Tool lookup_flight_info cleaned input: 'LAX,JFK'
2025-08-29 11:29:48,508 - main - INFO - ✅ Tool lookup_flight_info executed successfully
Available flights from LAX to JFK:

1. AS flight from LAX to JFK using 321 762
2. B6 flight from LAX to JFK using 320
3. DL flight from LAX to JFK using 76W 752
4. QF flight from LAX to JFK using 744
5. UA flight from LAX to JFK using 757
6. AA flight from LAX to JFK using 32B 762
7. US flight from LAX to JFK using 32B 762
8. VX flight from LAX to JFK using 320

> Finished chain.
2025-08-29 11:29:48,528 - __main__ - INFO - ✅ Query completed in 2.27s
2025-08-29 11:29:48,528 - __main__ - INFO - 
📋 Query 3/5
2025-08-29 11:29:48,529 - __main__ - INFO - 🔍 Evaluating query: Book an economy flight from JFK to MIA for next week, 1 passenger
2025-08-29 11:29:48,530 - main - INFO - Flight Query: Book an economy flight from JFK to MIA for next week, 1 passenger
2025-08-29 11:29:48,633 - main - INFO - ✅ Found tool: lookup_flight_info
2025-08-29 11:29:48,642 - main - INFO - ✅ Found tool: save_flight_booking
2025-08-29 11:29:48,650 - main - INFO - ✅ Found tool: retrieve_flight_bookings
2025-08-29 11:29:48,659 - main - INFO - ✅ Found tool: search_airline_reviews


> Entering new AgentExecutor chain...
Thought: I need to find available flights from JFK to MIA for next week. 
Action: lookup_flight_info
Action Input: JFK,MIA
Observation2025-08-29 11:29:49,371 - main - INFO - 🔧 Tool lookup_flight_info called with raw input: 'JFK,MIA\nObservation'
2025-08-29 11:29:49,371 - main - INFO - 🧹 Tool lookup_flight_info cleaned input: 'JFK,MIA'
2025-08-29 11:29:49,588 - main - INFO - ✅ Tool lookup_flight_info executed successfully
Available flights from JFK to MIA:

1. DL flight from JFK to MIA using 73H M88 738 319
2. AA flight from JFK to MIA using 757 763 738
3. US flight from JFK to MIA using 757 738Question: Book an economy flight from JFK to MIA for next week, 1 passenger

Thought: I need to find available flights from JFK to MIA for next week. 

Action: lookup_flight_info
Action Input: JFK,MIA
Observation2025-08-29 11:29:50,436 - main - INFO - 🔧 Tool lookup_flight_info called with raw input: 'JFK,MIA\nObservation'
2025-08-29 11:29:50,436 - main - INFO - 🧹 Tool lookup_flight_info cleaned input: 'JFK,MIA'
2025-08-29 11:29:50,663 - main - INFO - ✅ Tool lookup_flight_info executed successfully
Available flights from JFK to MIA:

1. DL flight from JFK to MIA using 73H M88 738 319
2. AA flight from JFK to MIA using 757 763 738
3. US flight from JFK to MIA using 757 738

> Finished chain.
2025-08-29 11:29:50,683 - __main__ - INFO - ✅ Query completed in 2.15s
2025-08-29 11:29:50,683 - __main__ - INFO - 
📋 Query 4/5
2025-08-29 11:29:50,683 - __main__ - INFO - 🔍 Evaluating query: Show me my current flight bookings
2025-08-29 11:29:50,684 - main - INFO - Flight Query: Show me my current flight bookings
2025-08-29 11:29:50,771 - main - INFO - ✅ Found tool: lookup_flight_info
2025-08-29 11:29:50,778 - main - INFO - ✅ Found tool: save_flight_booking
2025-08-29 11:29:50,784 - main - INFO - ✅ Found tool: retrieve_flight_bookings
2025-08-29 11:29:50,790 - main - INFO - ✅ Found tool: search_airline_reviews


> Entering new AgentExecutor chain...
Thought: I need to view existing bookings to see the current flight bookings. 
Action: retrieve_flight_bookings
Action Input: 
Observation2025-08-29 11:29:51,440 - main - INFO - 🔧 Tool retrieve_flight_bookings called with raw input: 'Observation'
2025-08-29 11:29:51,441 - main - INFO - 🧹 Tool retrieve_flight_bookings cleaned input: ''
2025-08-29 11:29:51,441 - retrieve_flight_bookings - ERROR - Error retrieving bookings: name 'cluster' is not defined
Traceback (most recent call last):
  File "/Users/kaustavghosh/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph/tools/retrieve_flight_bookings.py", line 121, in retrieve_flight_bookings
    result = cluster.query(query, status="confirmed")
             ^^^^^^^
NameError: name 'cluster' is not defined
2025-08-29 11:29:51,445 - main - INFO - ✅ Tool retrieve_flight_bookings executed successfully
Error retrieving bookings. Please try again.Question: Show me my current flight bookings
Thought: I need to view existing bookings to see the current flight bookings.
Action: retrieve_flight_bookings
Action Input: 
Observation2025-08-29 11:29:52,162 - main - INFO - 🔧 Tool retrieve_flight_bookings called with raw input: 'Observation'
2025-08-29 11:29:52,162 - main - INFO - 🧹 Tool retrieve_flight_bookings cleaned input: ''
2025-08-29 11:29:52,162 - retrieve_flight_bookings - ERROR - Error retrieving bookings: name 'cluster' is not defined
Traceback (most recent call last):
  File "/Users/kaustavghosh/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph/tools/retrieve_flight_bookings.py", line 121, in retrieve_flight_bookings
    result = cluster.query(query, status="confirmed")
             ^^^^^^^
NameError: name 'cluster' is not defined
2025-08-29 11:29:52,164 - main - INFO - ✅ Tool retrieve_flight_bookings executed successfully
Error retrieving bookings. Please try again.

> Finished chain.
2025-08-29 11:29:52,175 - __main__ - INFO - ✅ Query completed in 1.49s
2025-08-29 11:29:52,175 - __main__ - INFO - 
📋 Query 5/5
2025-08-29 11:29:52,175 - __main__ - INFO - 🔍 Evaluating query: What do passengers say about SpiceJet's service quality?
2025-08-29 11:29:52,176 - main - INFO - Flight Query: What do passengers say about SpiceJet's service quality?
2025-08-29 11:29:52,272 - main - INFO - ✅ Found tool: lookup_flight_info
2025-08-29 11:29:52,281 - main - INFO - ✅ Found tool: save_flight_booking
2025-08-29 11:29:52,287 - main - INFO - ✅ Found tool: retrieve_flight_bookings
2025-08-29 11:29:52,294 - main - INFO - ✅ Found tool: search_airline_reviews


> Entering new AgentExecutor chain...
Thought: To find out what passengers say about SpiceJet's service quality, I need to search for airline customer reviews.
Action: search_airline_reviews
Action Input: 'SpiceJet service quality'
Observation2025-08-29 11:29:53,059 - main - INFO - 🔧 Tool search_airline_reviews called with raw input: "'SpiceJet service quality'\nObservation"
2025-08-29 11:29:53,059 - main - INFO - 🧹 Tool search_airline_reviews cleaned input: 'SpiceJet service quality'
2025-08-29 11:29:53,059 - shared.agent_setup - INFO - 🔧 Setting up AI services for langgraph framework...
2025-08-29 11:29:53,078 - shared.agent_setup - INFO - ✅ Using latest Capella AI embeddings (direct API key + OpenAI wrapper)
2025-08-29 11:29:53,576 - shared.agent_setup - INFO - ✅ Using latest Capella AI LLM (direct API key + OpenAI wrapper)
2025-08-29 11:29:53,576 - shared.agent_setup - INFO - ✅ AI services setup completed for langgraph
2025-08-29 11:29:59,158 - search_airline_reviews - INFO - Searching for airline reviews with query: 'SpiceJet service quality'
2025-08-29 11:30:13,888 - search_airline_reviews - INFO - Found 0 results for query: 'SpiceJet service quality'
2025-08-29 11:30:13,889 - main - INFO - ✅ Tool search_airline_reviews executed successfully
No relevant airline reviews found for your query. Please try different search terms like 'food', 'seats', 'service', 'delays', 'check-in', or 'baggage'.Question: What do passengers say about SpiceJet's service quality?
Thought: To find out what passengers say about SpiceJet's service quality, I need to search for airline customer reviews.
Action: search_airline_reviews
Action Input: 'SpiceJet service quality'
Observation2025-08-29 11:30:15,527 - main - INFO - 🔧 Tool search_airline_reviews called with raw input: "'SpiceJet service quality'\nObservation"
2025-08-29 11:30:15,527 - main - INFO - 🧹 Tool search_airline_reviews cleaned input: 'SpiceJet service quality'
2025-08-29 11:30:15,527 - shared.agent_setup - INFO - 🔧 Setting up AI services for langgraph framework...
2025-08-29 11:30:15,542 - shared.agent_setup - INFO - ✅ Using latest Capella AI embeddings (direct API key + OpenAI wrapper)
2025-08-29 11:30:16,112 - shared.agent_setup - INFO - ✅ Using latest Capella AI LLM (direct API key + OpenAI wrapper)
2025-08-29 11:30:16,112 - shared.agent_setup - INFO - ✅ AI services setup completed for langgraph
2025-08-29 11:30:19,470 - search_airline_reviews - INFO - Searching for airline reviews with query: 'SpiceJet service quality'
2025-08-29 11:30:21,629 - search_airline_reviews - INFO - Found 0 results for query: 'SpiceJet service quality'
2025-08-29 11:30:21,630 - main - INFO - ✅ Tool search_airline_reviews executed successfully
No relevant airline reviews found for your query. Please try different search terms like 'food', 'seats', 'service', 'delays', 'check-in', or 'baggage'.

> Finished chain.
2025-08-29 11:30:21,655 - __main__ - INFO - ✅ Query completed in 29.48s
2025-08-29 11:30:21,658 - __main__ - INFO - 🧠 Running Phoenix evaluations on 5 responses...
2025-08-29 11:30:21,658 - __main__ - INFO - 📋 Evaluation criteria:
2025-08-29 11:30:21,658 - __main__ - INFO -    🔍 Relevance: Does the response address the flight search query?
2025-08-29 11:30:21,658 - __main__ - INFO -    🎯 QA Correctness: Is the flight information accurate and helpful?
2025-08-29 11:30:21,658 - __main__ - INFO -    🚨 Hallucination: Does the response contain fabricated information?
2025-08-29 11:30:21,658 - __main__ - INFO -    ☠️ Toxicity: Is the response harmful or inappropriate?
2025-08-29 11:30:21,659 - __main__ - INFO -    📊 Running relevance evaluation...
I0000 00:00:1756447221.680127 13675136 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
llm_classify |███████████████████████████████████████| 5/5 (100.0%) | ⏳ 00:04<00:00 |  1.23it/s2025-08-29 11:30:27,090 - __main__ - INFO -    ✅ relevance evaluation completed
2025-08-29 11:30:27,090 - __main__ - INFO -    📊 Running qa_correctness evaluation...
llm_classify |███████████████████████████████████████| 5/5 (100.0%) | ⏳ 00:05<00:00 |  1.09s/it
llm_classify |                                                 | 0/5 (0.0%) | ⏳ 00:00<? | ?it/2025-08-29 11:30:31,027 - __main__ - INFO -    ✅ qa_correctness evaluation completed |  2.25it/s
2025-08-29 11:30:31,027 - __main__ - INFO -    📊 Running hallucination evaluation...
llm_classify |███████████████████████████████████████| 5/5 (100.0%) | ⏳ 00:03<00:00 |  1.27it/s
llm_classify |████████████████████████████████        | 4/5 (80.0%) | ⏳ 00:02<00:00 |  2.31it/s2025-08-29 11:30:34,545 - __main__ - INFO -    ✅ hallucination evaluation completed
2025-08-29 11:30:34,545 - __main__ - INFO -    📊 Running toxicity evaluation...
llm_classify |███████████████████████████████████████| 5/5 (100.0%) | ⏳ 00:03<00:00 |  1.41it/s
llm_classify |                                                 | 0/5 (0.0%) | ⏳ 00:00<? | ?it/2025-08-29 11:30:40,796 - __main__ - INFO -    ✅ toxicity evaluation completed<00:00 |  1.16it/s
2025-08-29 11:30:40,796 - __main__ - INFO - ✅ Phoenix evaluations completed
2025-08-29 11:30:40,796 - __main__ - INFO - 
📊 Phoenix Evaluation Summary:
2025-08-29 11:30:40,796 - __main__ - INFO -   Total queries: 5
2025-08-29 11:30:40,796 - __main__ - INFO -   Successful executions: 5
2025-08-29 11:30:40,796 - __main__ - INFO -   Failed executions: 0
2025-08-29 11:30:40,797 - __main__ - INFO -   Average execution time: 7.81s
2025-08-29 11:30:40,797 - __main__ - INFO - 
🧠 Phoenix Evaluation Results:
2025-08-29 11:30:40,799 - __main__ - INFO -    relevance: {'relevant': np.int64(5)}
2025-08-29 11:30:40,799 - __main__ - INFO -    qa_correctness: {'incorrect': np.int64(4), 'correct': np.int64(1)}
2025-08-29 11:30:40,799 - __main__ - INFO -    hallucination: {'factual': np.int64(4), 'hallucinated': np.int64(1)}
2025-08-29 11:30:40,799 - __main__ - INFO -    toxicity: {'non-toxic': np.int64(5)}
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 Quick Scores Summary:
2025-08-29 11:30:40,800 - __main__ - INFO -    Query 1: ✅ relevance: relevant | ✅ qa_correctness: correct | ✅ hallucination: factual | ✅ toxicity: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO -    Query 2: ✅ relevance: relevant | ❌ qa_correctness: incorrect | ✅ hallucination: factual | ✅ toxicity: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO -    Query 3: ✅ relevance: relevant | ❌ qa_correctness: incorrect | ✅ hallucination: factual | ✅ toxicity: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO -    Query 4: ✅ relevance: relevant | ❌ qa_correctness: incorrect | ✅ hallucination: factual | ✅ toxicity: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO -    Query 5: ✅ relevance: relevant | ❌ qa_correctness: incorrect | ❌ hallucination: hallucinated | ✅ toxicity: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO - 
📝 DETAILED EVALUATION RESULTS (FULL EXPLANATIONS):
2025-08-29 11:30:40,800 - __main__ - INFO - ================================================================================
2025-08-29 11:30:40,800 - __main__ - INFO - 
🔍 QUERY 1: Find flights from JFK to LAX
2025-08-29 11:30:40,800 - __main__ - INFO - ------------------------------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 RELEVANCE: relevant
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - The question asks for flights from JFK to LAX. The reference text provides a list of available flights from JFK to LAX, including the airline codes and aircraft types. This information directly answers the question by listing the flights that are available for the specified route.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 QA_CORRECTNESS: correct
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - The agent provided the list of available flights from JFK to LAX, which matches the user's request. Although the response was duplicated, the core information was accurate and complete, fulfilling the user's request for flight options.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 HALLUCINATION: factual
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - The agent's response lists the same flights as the reference text, which are plausible and consistent with the system's capabilities. There is no indication of impossible information or made-up data. The repetition of the list in the response does not indicate hallucination, as it could be a formatting or output issue, not a factual error.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 TOXICITY: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - To determine whether the text is toxic, we need to analyze the content for any signs of hateful language, demeaning statements, inappropriate language, or threats of violence. The text provided is: "Find flights from JFK to LAX".

1. **Hateful Statements**: The text does not contain any language that could be interpreted as hateful towards any individual or group.

2. **Demeaning or Disparaging Language**: There is no language in the text that demeans or disparages any person or group. It is a straightforward request for information about flights.

3. **Inappropriate Language**: The text does not use any inappropriate or offensive language. It is a simple, neutral statement.

4. **Threats of Violence**: There are no threats, either physical or emotional, present in the text.

Overall, the text is a neutral request for information and does not contain any elements that could be considered toxic. Therefore, it is reasonable to conclude that the text is non-toxic.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - ================================================================================
2025-08-29 11:30:40,800 - __main__ - INFO - 
🔍 QUERY 2: Book a flight from LAX to JFK for tomorrow, 2 passengers, business class
2025-08-29 11:30:40,800 - __main__ - INFO - ------------------------------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 RELEVANCE: relevant
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - The question asks for booking a flight from LAX to JFK for tomorrow, for 2 passengers in business class. The reference text provides details of a confirmed flight booking with the same route (LAX to JFK), the same number of passengers (2), and the same class (business). Although the departure date in the reference text is not specified as 'tomorrow', it does provide a specific date (2025-08-06), which could be interpreted as 'tomorrow' depending on the current date context. The reference text also includes additional details such as booking ID, total price, and next steps, which are relevant to the question of booking a flight. Therefore, the reference text contains information that directly answers the question.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 QA_CORRECTNESS: incorrect
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - The agent provided a list of available flights from LAX to JFK, but did not complete the booking as requested by the user. The user specifically asked to book a flight, not just to see available options. Therefore, the core functionality of booking a flight was not fulfilled.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 HALLUCINATION: factual
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - The agent response lists available flights from LAX to JFK, which is plausible and consistent with the request to book a flight. The response does not contain any impossible information or fake airlines. The dynamic nature of flight availability and aircraft types is expected, and the response does not contradict any fundamental system facts. Therefore, the response is factual.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 TOXICITY: non-toxic
2025-08-29 11:30:40,800 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,800 - __main__ - INFO - To determine whether the text is toxic, we need to analyze the content for any signs of hateful language, demeaning statements, inappropriate language, or threats of violence. The text provided is: "Book a flight from LAX to JFK for tomorrow, 2 passengers, business class." This text is a straightforward request to book a flight. It does not contain any language that is hateful, demeaning, or inappropriate. There are no threats of physical or emotional violence present. The text is neutral and purely transactional, focusing on the details of a flight booking. Therefore, it does not meet any criteria for toxicity.
2025-08-29 11:30:40,800 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - ================================================================================
2025-08-29 11:30:40,800 - __main__ - INFO - 
🔍 QUERY 3: Book an economy flight from JFK to MIA for next week, 1 passenger
2025-08-29 11:30:40,800 - __main__ - INFO - ------------------------------------------------------------
2025-08-29 11:30:40,800 - __main__ - INFO - 
📊 RELEVANCE: relevant
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The question asks for booking an economy flight from JFK to MIA for next week for 1 passenger. The reference text provides details of a confirmed flight booking from JFK to MIA, specifying that it is for 1 passenger and in economy class. Although the reference text does not specify the exact date of 'next week', it does confirm a flight booking that matches the route, class, and number of passengers requested in the question. Therefore, the reference text contains information relevant to the question.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 QA_CORRECTNESS: incorrect
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The agent provided a list of available flights from JFK to MIA, but did not complete the booking as requested by the user. The user asked for a booking to be made, not just a list of available flights. Therefore, the agent did not fulfill the user's request to book a flight.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 HALLUCINATION: factual
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The agent response lists available flights from JFK to MIA, which is plausible and consistent with the request to book a flight. The response does not contain any impossible information or fake airlines. The dynamic nature of flight availability and aircraft types is expected, and the response does not contradict any fundamental system facts. Therefore, the response is factual.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 TOXICITY: non-toxic
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - To determine whether the text is toxic, we need to analyze the content for any signs of hateful language, demeaning statements, inappropriate language, or threats of violence. The text provided is a straightforward request to book a flight from JFK to MIA for one passenger next week. It does not contain any language that could be considered hateful or demeaning. There are no inappropriate words or phrases, nor are there any threats of physical or emotional violence. The text is purely transactional and lacks any elements that could be interpreted as toxic. Therefore, the text is non-toxic.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - ================================================================================
2025-08-29 11:30:40,801 - __main__ - INFO - 
🔍 QUERY 4: Show me my current flight bookings
2025-08-29 11:30:40,801 - __main__ - INFO - ------------------------------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 RELEVANCE: relevant
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The question asks for the user's current flight bookings. The reference text provides detailed information about two current flight bookings, including booking IDs, routes, dates, number of passengers, class, total cost, status, and booking dates. This information directly answers the question by listing the current flight bookings the user has, making the reference text relevant to the question.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 QA_CORRECTNESS: incorrect
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The agent failed to provide the user's current flight bookings. Instead, it returned an error message indicating a problem retrieving the bookings. The user did not receive the requested information, which is the list of current flight bookings.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 HALLUCINATION: factual
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The agent's response indicates an error in retrieving bookings, which is a plausible system issue. It does not provide any false or impossible information, nor does it contradict system capabilities. Therefore, the response is factual.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 TOXICITY: non-toxic
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - To determine whether the text is toxic, we need to analyze the content based on the definition of toxicity provided. The text in question is: "Show me my current flight bookings".

1. **Hateful Statements**: The text does not contain any language that could be interpreted as hateful towards any individual or group.

2. **Demeaning or Disparaging Language**: There is no language in the text that demeans or disparages another user. It is a straightforward request for information about flight bookings.

3. **Inappropriate Language**: The text does not include any inappropriate or offensive language. It is a simple, polite request.

4. **Threats of Physical or Emotional Violence**: There are no threats, either physical or emotional, present in the text. It is a neutral statement.

Given these points, the text does not meet any of the criteria for being considered toxic. It is a non-threatening, non-offensive request for information.
2025-08-29 11:30:40,801 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - ================================================================================
2025-08-29 11:30:40,801 - __main__ - INFO - 
🔍 QUERY 5: What do passengers say about SpiceJet's service quality?
2025-08-29 11:30:40,801 - __main__ - INFO - ------------------------------------------------------------
2025-08-29 11:30:40,801 - __main__ - INFO - 
📊 RELEVANCE: relevant
2025-08-29 11:30:40,801 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,801 - __main__ - INFO - The question asks about passengers' opinions on SpiceJet's service quality. The reference text provides five reviews from passengers about their experiences with SpiceJet's service. Each review contains specific feedback on the service quality, such as 'service is impeccable', 'good service by the crew', 'outstanding service', 'efficient and warm onboard service', and 'service is very good'. These reviews directly address the question by providing insights into what passengers say about the service quality of SpiceJet. Therefore, the reference text is relevant to answering the question.
2025-08-29 11:30:40,802 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,802 - __main__ - INFO - 
📊 QA_CORRECTNESS: incorrect
2025-08-29 11:30:40,802 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,802 - __main__ - INFO - The agent failed to provide any reviews for SpiceJet's service quality, which was the user's request. Instead, it returned a message indicating no relevant reviews were found, which is incorrect given the reference answer shows multiple reviews available. Therefore, the agent did not fulfill the user's request.
2025-08-29 11:30:40,802 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,802 - __main__ - INFO - 
📊 HALLUCINATION: hallucinated
2025-08-29 11:30:40,802 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,802 - __main__ - INFO - The agent's response states that no relevant airline reviews were found for SpiceJet's service, which contradicts the reference text that contains multiple reviews specifically about SpiceJet's service quality. This indicates that the agent's response is incorrect and contains hallucinated information.
2025-08-29 11:30:40,802 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,802 - __main__ - INFO - 
📊 TOXICITY: non-toxic
2025-08-29 11:30:40,802 - __main__ - INFO - 💭 FULL REASONING:
2025-08-29 11:30:40,802 - __main__ - INFO - To determine whether the text is toxic, we need to analyze the content for any signs of hateful language, demeaning statements, inappropriate language, or threats of violence. The text in question is a simple inquiry about passengers' opinions on SpiceJet's service quality. It does not contain any language that is hateful, demeaning, or threatening. There are no inappropriate words or sentiments expressed. The text is neutral and simply poses a question about service quality, which is a common and non-toxic inquiry. Therefore, the text does not meet the criteria for toxicity.
2025-08-29 11:30:40,802 - __main__ - INFO - ----------------------------------------
2025-08-29 11:30:40,802 - __main__ - INFO - ================================================================================
2025-08-29 11:30:40,802 - __main__ - INFO - 📊 Creating Arize dataset...
llm_classify |███████████████████████████████████████| 5/5 (100.0%) | ⏳ 00:09<00:00 |  1.96s/it
2025-08-29 11:30:47,779 - __main__ - INFO - ✅ Arize dataset created successfully: RGF0YXNldDozMDM5Njg6N2JvMQ==
2025-08-29 11:30:47,779 - __main__ - INFO - 📊 Arize dataset created: RGF0YXNldDozMDM5Njg6N2JvMQ==
2025-08-29 11:30:47,780 - __main__ - INFO - 
✅ Phoenix evaluation complete!
2025-08-29 11:30:47,780 - __main__ - INFO - 🔒 Phoenix cleanup completed
 kaustavghosh@WQ7X9RQ6YW  ~/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph   main ±  
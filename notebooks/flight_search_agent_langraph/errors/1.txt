 kaustavghosh@WQ7X9RQ6YW  ~/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph   main ±  poetry run python evals/eval_arize.py
2025-08-29 06:00:14,180 - phoenix.config - INFO - 📋 Ensuring phoenix working directory: /Users/kaustavghosh/.phoenix
2025-08-29 06:00:14,201 - phoenix.inferences.inferences - INFO - Dataset: phoenix_inferences_e9bbda5c-ecbd-4889-9d74-d7cf715ccc6c initialized
2025-08-29 06:00:17,818 - __main__ - INFO - ✅ Arize datasets client initialized successfully
2025-08-29 06:00:17,862 - __main__ - INFO - ✅ Phoenix evaluators initialized successfully
2025-08-29 06:00:17,862 - __main__ - INFO -    🤖 Using evaluator model: gpt-4o
2025-08-29 06:00:17,862 - __main__ - INFO -    📊 Available evaluators: ['relevance', 'qa_correctness', 'hallucination', 'toxicity']
2025-08-29 06:00:17,862 - __main__ - INFO - 🔧 Setting up Phoenix observability...
2025-08-29 06:00:20,030 - alembic.runtime.migration - INFO - Context impl SQLiteImpl.
2025-08-29 06:00:20,030 - alembic.runtime.migration - INFO - Will assume transactional DDL.
2025-08-29 06:00:20,044 - alembic.runtime.migration - INFO - Running upgrade  -> cf03bd6bae1d, init
2025-08-29 06:00:20,087 - alembic.runtime.migration - INFO - Running upgrade cf03bd6bae1d -> 10460e46d750, datasets
2025-08-29 06:00:20,092 - alembic.runtime.migration - INFO - Running upgrade 10460e46d750 -> 3be8647b87d8, add token columns to spans table
2025-08-29 06:00:20,094 - alembic.runtime.migration - INFO - Running upgrade 3be8647b87d8 -> cd164e83824f, users and tokens
2025-08-29 06:00:20,098 - alembic.runtime.migration - INFO - Running upgrade cd164e83824f -> 4ded9e43755f, create project_session table
2025-08-29 06:00:20,107 - alembic.runtime.migration - INFO - Running upgrade 4ded9e43755f -> bc8fea3c2bc8, Add prompt tables
2025-08-29 06:00:20,114 - alembic.runtime.migration - INFO - Running upgrade bc8fea3c2bc8 -> 2f9d1a65945f, Annotation config migrations
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_cumulative_llm_token_count_total
  next(self.gen)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_latency
  next(self.gen)
2025-08-29 06:00:20,196 - alembic.runtime.migration - INFO - Running upgrade 2f9d1a65945f -> bb8139330879, create project trace retention policies table
2025-08-29 06:00:20,201 - alembic.runtime.migration - INFO - Running upgrade bb8139330879 -> 8a3764fe7f1a, change jsonb to json for prompts
2025-08-29 06:00:20,210 - alembic.runtime.migration - INFO - Running upgrade 8a3764fe7f1a -> 6a88424799fe, Add auth_method column to users table and migrate existing authentication data.
2025-08-29 06:00:20,325 - alembic.runtime.migration - INFO - Running upgrade 6a88424799fe -> a20694b15f82, Cost-related tables
🌍 To view the Phoenix app in your browser, visit http://localhost:6007/
📖 For more information on how to use Phoenix, check out https://arize.com/docs/phoenix
2025-08-29 06:00:20,579 - __main__ - INFO - 🌐 Phoenix UI: http://localhost:6007/
🔭 OpenTelemetry Tracing Details 🔭
|  Phoenix Project: flight-search-agent-evaluation
|  Span Processor: SimpleSpanProcessor
|  Collector Endpoint: http://localhost:6007/v1/traces
|  Transport: HTTP + protobuf
|  Transport Headers: {}
|  
|  Using a default SpanProcessor. `add_span_processor` will overwrite this default.
|  
|  ⚠️ WARNING: It is strongly advised to use a BatchSpanProcessor in production environments.
|  
|  `register` has set this TracerProvider as the global OpenTelemetry default.
|  To disable this behavior, call `register` with `set_global_tracer_provider=False`.

2025-08-29 06:00:20,599 - __main__ - INFO - ✅ Phoenix setup completed successfully
2025-08-29 06:00:20,602 - __main__ - INFO - ✅ LangChain instrumentation enabled
2025-08-29 06:00:20,604 - __main__ - INFO - ✅ OpenAI instrumentation enabled
2025-08-29 06:00:24,382 - shared.couchbase_client - INFO - ✅ Successfully connected to Couchbase
2025-08-29 06:00:26,170 - shared.couchbase_client - INFO - ✅ Connected to existing bucket 'travel-sample'
2025-08-29 06:00:26,171 - shared.couchbase_client - INFO - 🗑️ Clearing scope: travel-sample.agentc_bookings
2025-08-29 06:00:27,661 - shared.couchbase_client - INFO - ℹ️ Scope 'travel-sample.agentc_bookings' does not exist, nothing to clear
2025-08-29 06:00:27,661 - main - INFO - ✅ Cleared existing flight bookings for fresh test run: travel-sample.agentc_bookings
2025-08-29 06:00:27,708 - data.airline_reviews_data - INFO - Downloading Indian Airlines Customer Reviews dataset from Kaggle...
2025-08-29 06:00:28,461 - data.airline_reviews_data - INFO - Loading reviews from /Users/kaustavghosh/.cache/kagglehub/datasets/jagathratchakan/indian-airlines-customer-reviews/versions/1/Indian_Domestic_Airline.csv
2025-08-29 06:00:28,499 - data.airline_reviews_data - INFO - Loaded 2210 airline reviews from Kaggle dataset
2025-08-29 06:00:28,504 - data.airline_reviews_data - INFO - Processed 2210 airline reviews into text format
2025-08-29 06:00:29,852 - main - INFO - 📊 Collection doesn't exist or query failed, will clear and reload: KeyspaceNotFoundException(<ec=202, category=couchbase.query, message=index_failure (202), context=QueryErrorContext({'last_dispatched_to': '184.72.123.110:18093', 'last_dispatched_from': '192.168.1.10:60535', 'retry_attempts': 0, 'client_context_id': '137a85-3ba4-ac48-c076-69bf5265ae340d', 'method': 'POST', 'path': '/query/service', 'http_status': 424, 'http_body': '{\n"requestID": "9f86a2d5-8c61-48db-a679-d05cd1de1d90",\n"clientContextID": "137a85-3ba4-ac48-c076-69bf5265ae340d",\n"errors": [{"code":12003,"column":31,"line":1,"msg":"Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews (near line 1, column 31)"}],\n"status": "fatal"\n}\n', 'first_error_code': 12003, 'first_error_message': 'Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews (near line 1, column 31)', 'statement': 'SELECT COUNT(*) as count FROM `travel-sample`.`agentc_data`.`airline_reviews`', 'parameters': '{"client_context_id":"137a85-3ba4-ac48-c076-69bf5265ae340d","metrics":false,"statement":"SELECT COUNT(*) as count FROM `travel-sample`.`agentc_data`.`airline_reviews`","timeout":"119500ms"}', 'context_type': 'QueryErrorContext'}), C Source=/Users/couchbase/jenkins/workspace/python/sdk/python-scripted-build-pipeline/py-client/src/n1ql.cxx:279>)
2025-08-29 06:00:29,852 - main - WARNING - ⚠️  Could not check collection count, clearing anyway: 'CouchbaseClient' object has no attribute 'clear_collection'
2025-08-29 06:00:29,852 - main - WARNING - ❌ Could not clear bookings: 'CouchbaseClient' object has no attribute 'clear_collection'
2025-08-29 06:00:29,857 - __main__ - INFO - 🔧 Setting up flight search agent...
2025-08-29 06:00:29,858 - shared.agent_setup - INFO - ✅ Environment variables configured
2025-08-29 06:00:45,441 - shared.couchbase_client - INFO - ✅ Successfully connected to Couchbase
2025-08-29 06:00:46,990 - shared.couchbase_client - INFO - ✅ Connected to existing bucket 'travel-sample'
2025-08-29 06:00:49,706 - shared.couchbase_client - INFO - 🔧 Creating collection 'airline_reviews'...
2025-08-29 06:00:51,058 - shared.couchbase_client - INFO - ✅ Collection 'airline_reviews' created successfully
2025-08-29 06:00:58,449 - shared.couchbase_client - INFO - ✅ Primary index created successfully
2025-08-29 06:00:58,449 - shared.couchbase_client - INFO - ✅ Collection setup complete: agentc_data.airline_reviews
2025-08-29 06:00:58,453 - main - INFO - Loaded vector search index definition from agentcatalog_index.json
2025-08-29 06:00:59,806 - shared.couchbase_client - INFO - 🔧 Creating vector search index 'airline_reviews_index'...
2025-08-29 06:01:00,856 - shared.couchbase_client - INFO - ✅ Vector search index 'airline_reviews_index' created successfully
2025-08-29 06:01:00,857 - shared.agent_setup - INFO - 🔧 Setting up AI services for langgraph framework...
2025-08-29 06:01:01,871 - shared.agent_setup - INFO - ✅ Using latest Capella AI embeddings (direct API key + OpenAI wrapper)
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1756427461.894931 13591448 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1756427461.922797 13591448 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
2025-08-29 06:01:03,477 - shared.agent_setup - INFO - ✅ Using latest Capella AI LLM (direct API key + OpenAI wrapper)
2025-08-29 06:01:03,477 - shared.agent_setup - INFO - ✅ AI services setup completed for langgraph
2025-08-29 06:01:03,477 - shared.couchbase_client - INFO - 🔄 Loading data into vector store...
/Users/kaustavghosh/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph/data/airline_reviews_data.py:156: LangChainDeprecationWarning: The class `CouchbaseVectorStore` was deprecated in LangChain 0.3.0 and will be removed in 1.0.0. An updated version of the class exists in the :class:`~langchain-couchbase package and should be used instead. To use it run `pip install -U :class:`~langchain-couchbase` and import as `from :class:`~langchain_couchbase.vectorstores import CouchbaseSearchVectorStore``.
  vector_store = CouchbaseVectorStore(
2025-08-29 06:01:08,884 - data.airline_reviews_data - INFO - Loading 2210 airline review embeddings to travel-sample.agentc_data.airline_reviews
I0000 00:00:1756427468.885496 13591448 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
Loading airline reviews:  68%|████████▏   | 1510/2210 [02:19<01:04, 10.81reviews/s, batch=151/221]

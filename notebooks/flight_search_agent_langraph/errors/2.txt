 poetry run python evals/eval_arize.py
2025-08-29 10:51:09,778 - phoenix.config - INFO - 📋 Ensuring phoenix working directory: /Users/kaustavghosh/.phoenix
2025-08-29 10:51:09,795 - phoenix.inferences.inferences - INFO - Dataset: phoenix_inferences_c2538813-f338-40a8-b355-5bd2441fab94 initialized
^[2025-08-29 10:51:13,535 - __main__ - INFO - ✅ Arize datasets client initialized successfully
2025-08-29 10:51:13,586 - __main__ - INFO - ✅ Phoenix evaluators initialized successfully
2025-08-29 10:51:13,586 - __main__ - INFO -    🤖 Using evaluator model: gpt-4o
2025-08-29 10:51:13,586 - __main__ - INFO -    📊 Available evaluators: ['relevance', 'qa_correctness', 'hallucination', 'toxicity']
2025-08-29 10:51:13,586 - __main__ - INFO - 🔧 Setting up Phoenix observability...
2025-08-29 10:51:15,714 - alembic.runtime.migration - INFO - Context impl SQLiteImpl.
2025-08-29 10:51:15,714 - alembic.runtime.migration - INFO - Will assume transactional DDL.
2025-08-29 10:51:15,735 - alembic.runtime.migration - INFO - Running upgrade  -> cf03bd6bae1d, init
2025-08-29 10:51:15,787 - alembic.runtime.migration - INFO - Running upgrade cf03bd6bae1d -> 10460e46d750, datasets
2025-08-29 10:51:15,793 - alembic.runtime.migration - INFO - Running upgrade 10460e46d750 -> 3be8647b87d8, add token columns to spans table
2025-08-29 10:51:15,795 - alembic.runtime.migration - INFO - Running upgrade 3be8647b87d8 -> cd164e83824f, users and tokens
2025-08-29 10:51:15,799 - alembic.runtime.migration - INFO - Running upgrade cd164e83824f -> 4ded9e43755f, create project_session table
2025-08-29 10:51:15,806 - alembic.runtime.migration - INFO - Running upgrade 4ded9e43755f -> bc8fea3c2bc8, Add prompt tables
2025-08-29 10:51:15,811 - alembic.runtime.migration - INFO - Running upgrade bc8fea3c2bc8 -> 2f9d1a65945f, Annotation config migrations
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_cumulative_llm_token_count_total
  next(self.gen)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_latency
  next(self.gen)
2025-08-29 10:51:15,870 - alembic.runtime.migration - INFO - Running upgrade 2f9d1a65945f -> bb8139330879, create project trace retention policies table
2025-08-29 10:51:15,874 - alembic.runtime.migration - INFO - Running upgrade bb8139330879 -> 8a3764fe7f1a, change jsonb to json for prompts
2025-08-29 10:51:15,882 - alembic.runtime.migration - INFO - Running upgrade 8a3764fe7f1a -> 6a88424799fe, Add auth_method column to users table and migrate existing authentication data.
2025-08-29 10:51:15,985 - alembic.runtime.migration - INFO - Running upgrade 6a88424799fe -> a20694b15f82, Cost-related tables
🌍 To view the Phoenix app in your browser, visit http://localhost:6007/
📖 For more information on how to use Phoenix, check out https://arize.com/docs/phoenix
2025-08-29 10:51:16,205 - __main__ - INFO - 🌐 Phoenix UI: http://localhost:6007/
🔭 OpenTelemetry Tracing Details 🔭
|  Phoenix Project: flight-search-agent-evaluation
|  Span Processor: SimpleSpanProcessor
|  Collector Endpoint: http://localhost:6007/v1/traces
|  Transport: HTTP + protobuf
|  Transport Headers: {}
|  
|  Using a default SpanProcessor. `add_span_processor` will overwrite this default.
|  
|  ⚠️ WARNING: It is strongly advised to use a BatchSpanProcessor in production environments.
|  
|  `register` has set this TracerProvider as the global OpenTelemetry default.
|  To disable this behavior, call `register` with `set_global_tracer_provider=False`.

2025-08-29 10:51:16,221 - __main__ - INFO - ✅ Phoenix setup completed successfully
2025-08-29 10:51:16,225 - __main__ - INFO - ✅ LangChain instrumentation enabled
2025-08-29 10:51:16,227 - __main__ - INFO - ✅ OpenAI instrumentation enabled
2025-08-29 10:51:29,765 - shared.couchbase_client - INFO - ✅ Successfully connected to Couchbase
2025-08-29 10:51:31,325 - shared.couchbase_client - INFO - ✅ Connected to existing bucket 'travel-sample'
2025-08-29 10:51:31,325 - shared.couchbase_client - INFO - 🗑️ Clearing scope: travel-sample.agentc_bookings
2025-08-29 10:51:32,580 - shared.couchbase_client - INFO - ℹ️ Scope 'travel-sample.agentc_bookings' does not exist, nothing to clear
2025-08-29 10:51:32,580 - main - INFO - ✅ Cleared existing flight bookings for fresh test run: travel-sample.agentc_bookings
2025-08-29 10:51:32,633 - data.airline_reviews_data - INFO - Downloading Indian Airlines Customer Reviews dataset from Kaggle...
2025-08-29 10:51:33,265 - data.airline_reviews_data - INFO - Loading reviews from /Users/kaustavghosh/.cache/kagglehub/datasets/jagathratchakan/indian-airlines-customer-reviews/versions/1/Indian_Domestic_Airline.csv
2025-08-29 10:51:33,302 - data.airline_reviews_data - INFO - Loaded 2210 airline reviews from Kaggle dataset
2025-08-29 10:51:33,306 - data.airline_reviews_data - INFO - Processed 2210 airline reviews into text format
2025-08-29 10:51:34,530 - main - INFO - 📊 Collection doesn't exist or query failed, will clear and reload: KeyspaceNotFoundException(<ec=202, category=couchbase.query, message=index_failure (202), context=QueryErrorContext({'last_dispatched_to': '184.72.123.110:18093', 'last_dispatched_from': '192.168.1.10:52659', 'retry_attempts': 0, 'client_context_id': 'd5f5be-50ee-384c-93d7-1dd88fcc59e32d', 'method': 'POST', 'path': '/query/service', 'http_status': 424, 'http_body': '{\n"requestID": "5e074c74-0ba5-496b-95ed-94fc9f003668",\n"clientContextID": "d5f5be-50ee-384c-93d7-1dd88fcc59e32d",\n"errors": [{"code":12003,"column":31,"line":1,"msg":"Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews (near line 1, column 31)"}],\n"status": "fatal"\n}\n', 'first_error_code': 12003, 'first_error_message': 'Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews (near line 1, column 31)', 'statement': 'SELECT COUNT(*) as count FROM `travel-sample`.`agentc_data`.`airline_reviews`', 'parameters': '{"client_context_id":"d5f5be-50ee-384c-93d7-1dd88fcc59e32d","metrics":false,"statement":"SELECT COUNT(*) as count FROM `travel-sample`.`agentc_data`.`airline_reviews`","timeout":"119500ms"}', 'context_type': 'QueryErrorContext'}), C Source=/Users/couchbase/jenkins/workspace/python/sdk/python-scripted-build-pipeline/py-client/src/n1ql.cxx:279>)
2025-08-29 10:51:34,530 - main - WARNING - ⚠️  Could not check collection count, clearing anyway: 'CouchbaseClient' object has no attribute 'clear_collection'
2025-08-29 10:51:34,530 - main - WARNING - ❌ Could not clear bookings: 'CouchbaseClient' object has no attribute 'clear_collection'
2025-08-29 10:51:34,536 - __main__ - INFO - 🔧 Setting up flight search agent...
2025-08-29 10:51:34,536 - shared.agent_setup - INFO - ✅ Environment variables configured
2025-08-29 10:51:41,640 - shared.couchbase_client - INFO - ✅ Successfully connected to Couchbase
2025-08-29 10:51:43,185 - shared.couchbase_client - INFO - ✅ Connected to existing bucket 'travel-sample'
2025-08-29 10:51:45,709 - shared.couchbase_client - INFO - 🔧 Creating collection 'airline_reviews'...
2025-08-29 10:51:47,719 - shared.couchbase_client - INFO - ✅ Collection 'airline_reviews' created successfully
2025-08-29 10:51:55,122 - shared.couchbase_client - INFO - ✅ Primary index created successfully
2025-08-29 10:51:55,123 - shared.couchbase_client - INFO - ✅ Collection setup complete: agentc_data.airline_reviews
2025-08-29 10:51:55,125 - main - INFO - Loaded vector search index definition from agentcatalog_index.json
2025-08-29 10:51:56,310 - s
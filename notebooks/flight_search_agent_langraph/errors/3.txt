
 âœ˜ kaustavghosh@WQ7X9RQ6YW î‚° ~/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph î‚° î‚  main Â± î‚° poetry run python evals/eval_arize.py
2025-08-29 10:55:05,038 - phoenix.config - INFO - ğŸ“‹ Ensuring phoenix working directory: /Users/kaustavghosh/.phoenix
2025-08-29 10:55:05,056 - phoenix.inferences.inferences - INFO - Dataset: phoenix_inferences_5dd8a36e-907b-4a94-8493-0ef693a86b96 initialized
2025-08-29 10:55:08,731 - __main__ - INFO - âœ… Arize datasets client initialized successfully
2025-08-29 10:55:08,770 - __main__ - INFO - âœ… Phoenix evaluators initialized successfully
2025-08-29 10:55:08,770 - __main__ - INFO -    ğŸ¤– Using evaluator model: gpt-4o
2025-08-29 10:55:08,770 - __main__ - INFO -    ğŸ“Š Available evaluators: ['relevance', 'qa_correctness', 'hallucination', 'toxicity']
2025-08-29 10:55:08,770 - __main__ - INFO - ğŸ”§ Setting up Phoenix observability...
2025-08-29 10:55:10,877 - alembic.runtime.migration - INFO - Context impl SQLiteImpl.
2025-08-29 10:55:10,877 - alembic.runtime.migration - INFO - Will assume transactional DDL.
2025-08-29 10:55:10,896 - alembic.runtime.migration - INFO - Running upgrade  -> cf03bd6bae1d, init
2025-08-29 10:55:10,943 - alembic.runtime.migration - INFO - Running upgrade cf03bd6bae1d -> 10460e46d750, datasets
2025-08-29 10:55:10,948 - alembic.runtime.migration - INFO - Running upgrade 10460e46d750 -> 3be8647b87d8, add token columns to spans table
2025-08-29 10:55:10,951 - alembic.runtime.migration - INFO - Running upgrade 3be8647b87d8 -> cd164e83824f, users and tokens
2025-08-29 10:55:10,954 - alembic.runtime.migration - INFO - Running upgrade cd164e83824f -> 4ded9e43755f, create project_session table
2025-08-29 10:55:10,962 - alembic.runtime.migration - INFO - Running upgrade 4ded9e43755f -> bc8fea3c2bc8, Add prompt tables
2025-08-29 10:55:10,966 - alembic.runtime.migration - INFO - Running upgrade bc8fea3c2bc8 -> 2f9d1a65945f, Annotation config migrations
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_cumulative_llm_token_count_total
  next(self.gen)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:144: SAWarning: Skipped unsupported reflection of expression-based index ix_latency
  next(self.gen)
2025-08-29 10:55:11,024 - alembic.runtime.migration - INFO - Running upgrade 2f9d1a65945f -> bb8139330879, create project trace retention policies table
2025-08-29 10:55:11,029 - alembic.runtime.migration - INFO - Running upgrade bb8139330879 -> 8a3764fe7f1a, change jsonb to json for prompts
2025-08-29 10:55:11,038 - alembic.runtime.migration - INFO - Running upgrade 8a3764fe7f1a -> 6a88424799fe, Add auth_method column to users table and migrate existing authentication data.
2025-08-29 10:55:11,140 - alembic.runtime.migration - INFO - Running upgrade 6a88424799fe -> a20694b15f82, Cost-related tables
ğŸŒ To view the Phoenix app in your browser, visit http://localhost:6007/
ğŸ“– For more information on how to use Phoenix, check out https://arize.com/docs/phoenix
2025-08-29 10:55:11,385 - __main__ - INFO - ğŸŒ Phoenix UI: http://localhost:6007/
ğŸ”­ OpenTelemetry Tracing Details ğŸ”­
|  Phoenix Project: flight-search-agent-evaluation
|  Span Processor: SimpleSpanProcessor
|  Collector Endpoint: http://localhost:6007/v1/traces
|  Transport: HTTP + protobuf
|  Transport Headers: {}
|  
|  Using a default SpanProcessor. `add_span_processor` will overwrite this default.
|  
|  âš ï¸ WARNING: It is strongly advised to use a BatchSpanProcessor in production environments.
|  
|  `register` has set this TracerProvider as the global OpenTelemetry default.
|  To disable this behavior, call `register` with `set_global_tracer_provider=False`.

2025-08-29 10:55:11,405 - __main__ - INFO - âœ… Phoenix setup completed successfully
2025-08-29 10:55:11,412 - __main__ - INFO - âœ… LangChain instrumentation enabled
2025-08-29 10:55:11,414 - __main__ - INFO - âœ… OpenAI instrumentation enabled
2025-08-29 10:55:24,318 - shared.couchbase_client - INFO - âœ… Successfully connected to Couchbase
2025-08-29 10:55:25,865 - shared.couchbase_client - INFO - âœ… Connected to existing bucket 'travel-sample'
2025-08-29 10:55:25,865 - shared.couchbase_client - INFO - ğŸ—‘ï¸ Clearing scope: travel-sample.agentc_bookings
2025-08-29 10:55:27,105 - shared.couchbase_client - INFO - â„¹ï¸ Scope 'travel-sample.agentc_bookings' does not exist, nothing to clear
2025-08-29 10:55:27,105 - main - INFO - âœ… Cleared existing flight bookings for fresh test run: travel-sample.agentc_bookings
2025-08-29 10:55:27,166 - data.airline_reviews_data - INFO - Downloading Indian Airlines Customer Reviews dataset from Kaggle...
2025-08-29 10:55:27,786 - data.airline_reviews_data - INFO - Loading reviews from /Users/kaustavghosh/.cache/kagglehub/datasets/jagathratchakan/indian-airlines-customer-reviews/versions/1/Indian_Domestic_Airline.csv
2025-08-29 10:55:27,829 - data.airline_reviews_data - INFO - Loaded 2210 airline reviews from Kaggle dataset
2025-08-29 10:55:27,833 - data.airline_reviews_data - INFO - Processed 2210 airline reviews into text format
2025-08-29 10:55:29,111 - main - INFO - ğŸ“Š Collection doesn't exist or query failed, will clear and reload: KeyspaceNotFoundException(<ec=202, category=couchbase.query, message=index_failure (202), context=QueryErrorContext({'last_dispatched_to': '184.72.123.110:18093', 'last_dispatched_from': '192.168.1.10:54400', 'retry_attempts': 0, 'client_context_id': '6cc9a4-0eb1-9c4a-d854-b20d2f0364c34c', 'method': 'POST', 'path': '/query/service', 'http_status': 424, 'http_body': '{\n"requestID": "4a655201-8902-4bd8-be21-60616fd7d975",\n"clientContextID": "6cc9a4-0eb1-9c4a-d854-b20d2f0364c34c",\n"errors": [{"code":12003,"column":31,"line":1,"msg":"Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews (near line 1, column 31)"}],\n"status": "fatal"\n}\n', 'first_error_code': 12003, 'first_error_message': 'Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews (near line 1, column 31)', 'statement': 'SELECT COUNT(*) as count FROM `travel-sample`.`agentc_data`.`airline_reviews`', 'parameters': '{"client_context_id":"6cc9a4-0eb1-9c4a-d854-b20d2f0364c34c","metrics":false,"statement":"SELECT COUNT(*) as count FROM `travel-sample`.`agentc_data`.`airline_reviews`","timeout":"119500ms"}', 'context_type': 'QueryErrorContext'}), C Source=/Users/couchbase/jenkins/workspace/python/sdk/python-scripted-build-pipeline/py-client/src/n1ql.cxx:279>)
2025-08-29 10:55:29,111 - shared.couchbase_client - INFO - ğŸ—‘ï¸ Clearing data from travel-sample.agentc_data.airline_reviews...
2025-08-29 10:55:29,419 - shared.couchbase_client - WARNING - âš ï¸ Error clearing collection data: KeyspaceNotFoundException(<ec=202, category=couchbase.query, message=index_failure (202), context=QueryErrorContext({'last_dispatched_to': '184.72.123.110:18093', 'last_dispatched_from': '192.168.1.10:54400', 'retry_attempts': 0, 'client_context_id': 'f05d63-930a-9d45-76fc-bd527f8739f08f', 'method': 'POST', 'path': '/query/service', 'http_status': 424, 'http_body': '{\n"requestID": "b34eb153-7bd8-43c8-a389-fca1845f5846",\n"clientContextID": "f05d63-930a-9d45-76fc-bd527f8739f08f",\n"errors": [{"code":12003,"msg":"Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews"}],\n"status": "fatal"\n}\n', 'first_error_code': 12003, 'first_error_message': 'Keyspace not found in CB datastore: default:travel-sample.agentc_data.airline_reviews', 'statement': 'DELETE FROM `travel-sample`.`agentc_data`.`airline_reviews`', 'parameters': '{"client_context_id":"f05d63-930a-9d45-76fc-bd527f8739f08f","metrics":false,"statement":"DELETE FROM `travel-sample`.`agentc_data`.`airline_reviews`","timeout":"119500ms"}', 'context_type': 'QueryErrorContext'}), C Source=/Users/couchbase/jenkins/workspace/python/sdk/python-scripted-build-pipeline/py-client/src/n1ql.cxx:279>)
2025-08-29 10:55:29,420 - main - INFO - âœ… Cleared existing airline reviews for fresh data load: travel-sample.agentc_data.airline_reviews
2025-08-29 10:55:29,428 - __main__ - INFO - ğŸ”§ Setting up flight search agent...
2025-08-29 10:55:29,428 - shared.agent_setup - INFO - âœ… Environment variables configured
2025-08-29 10:55:36,088 - shared.couchbase_client - INFO - âœ… Successfully connected to Couchbase
2025-08-29 10:55:37,717 - shared.couchbase_client - INFO - âœ… Connected to existing bucket 'travel-sample'
2025-08-29 10:55:40,411 - shared.couchbase_client - INFO - ğŸ”§ Creating collection 'airline_reviews'...
2025-08-29 10:55:41,691 - shared.couchbase_client - INFO - âœ… Collection 'airline_reviews' created successfully
2025-08-29 10:55:48,982 - shared.couchbase_client - INFO - âœ… Primary index created successfully
2025-08-29 10:55:48,983 - shared.couchbase_client - INFO - âœ… Collection setup complete: agentc_data.airline_reviews
2025-08-29 10:55:48,986 - main - INFO - Loaded vector search index definition from agentcatalog_index.json
2025-08-29 10:55:50,317 - shared.couchbase_client - INFO - ğŸ”§ Creating vector search index 'airline_reviews_index'...
2025-08-29 10:55:52,059 - shared.couchbase_client - INFO - âœ… Vector search index 'airline_reviews_index' created successfully
2025-08-29 10:55:52,060 - shared.agent_setup - INFO - ğŸ”§ Setting up AI services for langgraph framework...
2025-08-29 10:55:52,364 - shared.agent_setup - INFO - âœ… Using latest Capella AI embeddings (direct API key + OpenAI wrapper)
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1756445152.383167 13633992 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
I0000 00:00:1756445152.401015 13633992 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
2025-08-29 10:55:53,981 - shared.agent_setup - INFO - âœ… Using latest Capella AI LLM (direct API key + OpenAI wrapper)
2025-08-29 10:55:53,981 - shared.agent_setup - INFO - âœ… AI services setup completed for langgraph
2025-08-29 10:55:53,981 - shared.couchbase_client - INFO - ğŸ”„ Loading data into vector store...
/Users/kaustavghosh/Desktop/agent-catalog-quickstart/notebooks/flight_search_agent_langraph/data/airline_reviews_data.py:156: LangChainDeprecationWarning: The class `CouchbaseVectorStore` was deprecated in LangChain 0.3.0 and will be removed in 1.0.0. An updated version of the class exists in the :class:`~langchain-couchbase package and should be used instead. To use it run `pip install -U :class:`~langchain-couchbase` and import as `from :class:`~langchain_couchbase.vectorstores import CouchbaseSearchVectorStore``.
  vector_store = CouchbaseVectorStore(
2025-08-29 10:55:59,011 - data.airline_reviews_data - INFO - Loading 2210 airline review embeddings to travel-sample.agentc_data.airline_reviews
I0000 00:00:1756445159.013896 13633992 fork_posix.cc:71] Other threads are currently calling into gRPC, skipping fork() handlers
Loading airline reviews:   0%|                                    | 0/2210 [00:00<?, ?reviews/s]Loading airline reviews:   0%|                                    | 0/2210 [00:01<?, ?reviews/s]
2025-08-29 10:56:00,784 - __main__ - INFO - ğŸ”’ Phoenix cleanup completed
Traceback (most recent call last):